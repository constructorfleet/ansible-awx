- name: Import checks for AWX/Tower containers
  ansible.builtin.import_tasks: verify-running.yml
  tags:
    - awx-settings
    - awx-credentials
    - awx-projects
    - awx-inventories
    - awx-jobs
    - awx-configuration

- name: Run AWX Container Tasks
  block:

    - name: Install Ansible and AWX/Tower Python dependencies
      ansible.builtin.pip:
        name: "{{ awx_pip_pkgs }}"
        state: present
      tags:
        - awx-settings
        - awx-credentials
        - awx-projects
        - awx-inventories
        - awx-jobs
        - awx-configuration

    - name: Import AWX/Tower settings tasks
      ansible.builtin.import_tasks: awx-config-settings.yml
      tags:
        - awx-settings

    - name: Import AWX/Tower credential tasks
      ansible.builtin.import_tasks: awx-config-credentials.yml
      tags:
        - awx-credentials

    - name: Import AWX/Tower project tasks
      ansible.builtin.import_tasks: awx-config-projects.yml
      tags:
        - awx-projects

    - name: Import AWX/Tower inventory tasks
      ansible.builtin.import_tasks: awx-config-inventories.yml
      tags:
        - awx-inventories

    - name: Import AWX/Tower job tasks
      ansible.builtin.import_tasks: awx-config-jobs.yml
      tags:
        - awx-jobs

  when: awx_containers_running
  tags:
    - awx-configuration
